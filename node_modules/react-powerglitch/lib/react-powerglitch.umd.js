(function(u,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],o):(u=typeof globalThis!="undefined"?globalThis:u||self,o(u.PowerGlitch={},u.React))})(this,function(u,o){"use strict";var w={};(function(l){Object.defineProperty(l,"__esModule",{value:!0}),l.PowerGlitch=l.mergeOptions=void 0;const g=(t="always")=>({playMode:t,createContainers:!0,hideOverflow:!1,timing:t==="always"?{duration:2*1e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:t==="always"?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:t==="click"?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0},pulse:!1}),p=(t,a)=>{if(!t.glitchTimeSpan)return 1;const e=t.glitchTimeSpan.start,n=t.glitchTimeSpan.end;if(a<e||a>n)return 0;const i=e+(n-e)/2;return a<i?(a-e)/(i-e):(n-a)/(n-i)},f=(t,a)=>(Math.random()-.5)*2*p(t,a),G=({minHeight:t,maxHeight:a,minWidth:e,maxWidth:n})=>{const i=Math.floor(Math.random()*((a-t)*100+1))+t*100,s=Math.floor(Math.random()*((n-e)*100+1))+e*100,r=Math.floor(Math.random()*(100-i)),c=Math.floor(Math.random()*(100-s)),y=`${c+s}% ${r}%`,h=`${c+s}% ${r+i}%`,d=`${c}% ${r+i}%`,C=`${c}% ${r}%`;return`polygon(${y},${h},${d},${C})`},E=t=>{const a=Math.floor(t.slice.velocity*t.timing.duration/1e3)+1,e=[];for(let n=0;n<a;++n){if(p(t,n/a)===0){e.push({opacity:"0",transform:"none",clipPath:"unset"});continue}const s={opacity:"1",transform:`translate3d(${f(t,n/a)*30}%,0,0)`,clipPath:G({minHeight:t.slice.minHeight,maxHeight:t.slice.maxHeight,minWidth:1,maxWidth:1})};t.slice.hueRotate&&(s.filter=`hue-rotate(${Math.floor(f(t,n/a)*360)}deg)`),e.push(s)}return{steps:e,timing:Object.assign({easing:`steps(${a},jump-start)`},t.timing)}},$=t=>t.pulse?{steps:[{transform:"scale(1)",opacity:"1"},{transform:`scale(${t.pulse.scale})`,opacity:"0"}],timing:Object.assign(Object.assign({},t.timing),{delay:(t.glitchTimeSpan?t.glitchTimeSpan.start:0)*t.timing.duration,easing:"ease-in-out"})}:null,M=t=>{if(!t.shake)return{steps:[],timing:{}};const a=Math.floor(t.shake.velocity*t.timing.duration/1e3)+1,e=[];for(let n=0;n<a;++n){const i=f(t,n/a)*t.shake.amplitudeX*100,s=f(t,n/a)*t.shake.amplitudeY*100;e.push({transform:`translate3d(${i}%,${s}%,0)`})}return{steps:e,timing:Object.assign({easing:`steps(${a},jump-start)`},t.timing)}},m=t=>[M(t),$(t),...Array.from({length:t.slice.count}).map(()=>E(t))].filter(a=>a!==null),v=(...t)=>{const a=e=>e&&typeof e=="object";return t.reduce((e,n)=>(Object.keys(n).forEach(i=>{a(e[i])&&a(n[i])?e[i]=(0,l.mergeOptions)(e[i],n[i]):n[i]!==void 0&&(e[i]=n[i])}),e),{})};l.mergeOptions=v;const S=(t,a)=>{var e,n;if(!a.createContainers)return{container:t,layersContainer:t,glitched:t.firstElementChild};if(!t.dataset.glitched){const r=document.createElement("div"),c=document.createElement("div");return getComputedStyle(t).getPropertyValue("display").match(/^inline/)&&(c.style.display="inline-block"),c.appendChild(r),(e=t.parentElement)===null||e===void 0||e.insertBefore(c,t),r.prepend(t),{container:c,layersContainer:r,glitched:t}}const i=t.parentElement,s=(n=t.parentElement)===null||n===void 0?void 0:n.parentElement;for(;i.children.length>1;)i.removeChild(i.children[1]);return i.firstElementChild.getAnimations().forEach(r=>r.cancel()),{container:s,layersContainer:i,glitched:t}},T=(t,a,e)=>{const{glitched:n,container:i,layersContainer:s}=S(t,e);s.style.display="grid",e.hideOverflow&&(i.style.overflow="hidden"),e.html&&(n.innerHTML=e.html),n.style.gridArea="1/1/-1/-1";const r=n.cloneNode(!0);r.style.gridArea="1/1/-1/-1",r.style.userSelect="none",r.style.pointerEvents="none",r.style.opacity="0";for(let h=0;h<a.length-1;++h){const d=r.cloneNode(!0);s.appendChild(d)}const c=()=>{a.forEach((h,d)=>{s.children[d].animate(h.steps,h.timing)})},y=()=>{a.forEach((h,d)=>{s.children[d].getAnimations().forEach(C=>{C.cancel()})})};switch(i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,e.playMode){case"always":c();break;case"hover":i.onmouseenter=c,i.onmouseleave=y;break;case"click":i.onclick=()=>{y(),c()};break}return t.dataset.glitched="1",{container:i,startGlitch:c,stopGlitch:y}},A=(t=".powerglitch",a={})=>{const e=(0,l.mergeOptions)(g(a.playMode),a);let n=[];typeof t=="string"?n=Array.from(document.querySelectorAll(t)):t instanceof NodeList?n=Array.from(t):Array.isArray(t)?n=t:t instanceof HTMLElement&&(n=[t]);const i=m(e),s=n.map(r=>T(r,i,e));return{containers:s.map(r=>r.container),startGlitch:()=>s.forEach(r=>r.startGlitch()),stopGlitch:()=>s.forEach(r=>r.stopGlitch())}};l.PowerGlitch={glitch:A,generateLayers:m,getDefaultOptions:g}})(w);function b(l){const[g,p]=o.useState(l),[f,G]=o.useState(()=>()=>{}),[E,$]=o.useState(()=>()=>{});return{ref:o.useCallback(m=>{if(!m)return;const v=w.PowerGlitch.glitch(m,g);G(()=>v.startGlitch),$(()=>v.stopGlitch)},[g]),startGlitch:f,stopGlitch:E,setOptions:p}}u.useGlitch=b,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
